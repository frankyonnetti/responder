<!DOCTYPE html>
<html>
  <head>
    <title>Responder</title>
  </head>

  <link href="./css/styles.css" media="all" rel="stylesheet">

  <script>
    window.$ = window.jQuery = require('./node_modules/jquery/dist/jquery.min.js');
    require('./js/menus.js');
    require('./js/scripts.js');

    onload = function() {

      // show webview loading...
      var webview = document.getElementById('foo');
      var indicator = document.querySelector('.indicator');

      var loadstart = function() {
        indicator.innerText = 'loading...';
      };
      var loadstop = function() {
        indicator.innerText = '';
      };
      webview.addEventListener('did-start-loading', loadstart);
      webview.addEventListener('did-stop-loading', loadstop);

      // Get URL from clicked link in webview.
      webview.addEventListener('dom-ready', function() {
        var clickedAnchor = webview.getUrl();
        document.getElementById('responder-url').value = clickedAnchor;
        // console.log(clickedAnchor);

        // var $ = require('jquery');
        // $("input#responder-url").focusout(function(){
          // alert("Keyup detected!");
        // });

      });

      // http://stackoverflow.com/questions/16048084/jquery-detect-textbox-value-change-not-based-on-user-input
      var $ = require('jquery');
      var $myText = $("input#responder-url");

      $myText.data("value", $myText.val());

      setInterval(function() {
        var data = $myText.data("value"),
          val = $myText.val();

        if (data !== val) {
          $myText.data("value", val);

          var responderURL = $('input#responder-url').val();
          $('.frame').each(function() {
            $(this).attr('src', responderURL);
            localStorage.setItem('urlItem', responderURL);
          });

        }
      }, 100);

      // show inspector.
      var a = document.getElementById('show');
      a.onclick = showCode;
    };

    // show inspector.
    function showCode() {
      var webview = document.getElementById('foo');
      webview.inspectElement(0, 0); // x, y
    }

  </script>

  <body>

    <header>
      <div id="url-submission">
        <input id="responder-url" type="text" placeholder="Enter URL">
        <button class="button-load">L</button> <button class="button-clear">C</button>
      </div>
    </header>

    <main><div class="main-container">

      <a id="show" href="#test">Show</a>

      <div class="indicator">Hello Indicator</div>

      <div id="device-area">

        <div class="device-window" style="width:332px;">
          <p>iPhone 5 (320 x 568)</p>
          <webview id="foo" class="frame" src="" style="width:332px; height:568px;"></webview>
        </div>

        <div class="device-window" style="width:387px;">
          <p>iPhone 6 (375 x 627)</p>
          <webview class="frame" src="" style="width:387px; height:627px;"></webview>
        </div>

        <div class="device-window" style="width:426px;">
          <p>iPhone 6 Plus (414 x 736)</p>
          <webview class="frame" src="" style="width:426px; height:736px;"></webview>
        </div>

        <br style="clear:both;">

      </div>

    </div></main>

    <!-- <p>We are using node <script>document.write(process.versions.node)</script>,<br>
    Chrome <script>document.write(process.versions.chrome)</script>,<br>
    and Electron <script>document.write(process.versions.electron)</script>.</p> -->

    <script src="http://localhost:23476/livereload.js"></script>

  </body>
</html>
